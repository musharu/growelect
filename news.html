<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>growelect</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/style_header.css">
    <link rel="stylesheet" href="css/style_footer.css">
    <link rel="stylesheet" href="css/news.css">
</head>


<body>
    <div data-include="parts/header.html"></div>

    <main>
        <!-- Hero -->
        <section class="sub-hero">
            <img src="image/test_image.png" alt="新着情報">
            <div class="sub-hero-text">
                <h2>お知らせ<br><span>News</span></h2>
            </div>
        </section>

        <!-- Navigation -->
        <nav class="sub-nav">
            <a href="#news" class="sub-nav__link">お知らせ</a>
        </nav>

        <!-- Breadcrumb -->
        <nav class="breadcrumb" aria-label="breadcrumb">
            <div class="sec-container">
                <ul>
                    <li><a href="index.html">ホーム</a></li>
                    <li>お知らせ</li>
                </ul>
            </div>
        </nav>
        
        
        <section id="news" class="sec-padding">
            <div class="sec-container">
                <h2 class="sec-title">お知らせ一覧</h2>
                <ul class="news__list" id="newsList"></ul>
            </div>
            <div class="pagination" id="pagination"></div>
        </section>

    
    </main>
    
    <div data-include="parts/footer.html"></div>

    <script src="js/include.js"></script>
</body>
</html>


<script>
document.addEventListener("DOMContentLoaded", () => {
    const itemsPerPage = 10; // 1ページあたりの記事数
    const maxPage = 10; // ページ数の上限

    // URLの ?page=2 のようなクエリからページ番号を取得
    const params = new URLSearchParams(window.location.search);
    const currentPage = parseInt(params.get("page")) || 1;

    fetch("data/articles_index.json")
        .then(res => res.json())
        .then(async (indexList) => {

            // 最新順（新しい順）に並べ替え
            const reversedList = [...indexList].reverse();

            // 総ページ数
            const totalPages = Math.min(Math.ceil(reversedList.length / itemsPerPage), maxPage);

            // 現在のページに対応する記事範囲を取得
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageIds = reversedList.slice(start, end);

            // 記事データを取得
            const articlePromises = pageIds.map(id =>
                fetch(`data/articles/${id}`).then(res => res.json())
            );
            const articles = await Promise.all(articlePromises);

            // HTMLに出力
            const list = document.getElementById("newsList");
            list.innerHTML = ""; // 一旦クリア
            articles.forEach(item => {
                const li = document.createElement("li");
                li.className = "news__item";
                li.innerHTML = `
                    <a href="detail.html?id=${item.id}&from=news" class="news__link">
                        <div class="news__meta">
                            <time class="news__date">${item.date.replace(/-/g, '.')}</time>
                            <span class="news__category">${item.category}</span>                            
                        </div>
                        <p class="news__message">${item.title}</p>
                    </a>
                `;
                list.appendChild(li);
            });

            // ページネーション作成
            const pagination = document.getElementById("pagination");
            pagination.innerHTML = "";
            for (let i = 1; i <= totalPages; i++) {
                const a = document.createElement("a");
                a.href = `?page=${i}`;
                a.textContent = i;
                a.className = "pagination__link";
                if (i === currentPage) a.classList.add("active");
                pagination.appendChild(a);
            }
        })
        .catch(err => {
            document.getElementById("newsList").innerHTML = "ニュースの読み込みに失敗しました。";
        });
    });

</script>