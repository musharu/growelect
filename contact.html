<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>growelect</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/style_header.css">
    <link rel="stylesheet" href="css/style_footer.css">
    <!-- <link rel="stylesheet" href="css/sub_recruit.css"> -->
    <link rel="stylesheet" href="css/contact.css">

</head>


<body>
    <div data-include="parts/header.html"></div>

    <main>
        <!-- Hero -->
        <section class="sub-hero">
            <img src="image/test_image.png" alt="新着情報">
            <div class="sub-hero-text">
                <h2>お問い合わせ<br><span>Content</span></h2>
            </div>
        </section>

        <!-- Navigation -->
        <nav class="sub-nav">
            <a href="#phone-contact" class="sub-nav__link">電話でのお問い合わせ</a>
            <a href="#mail-contact" class="sub-nav__link">メールでのお問い合わせ</a>
        </nav>

        <!-- Breadcrumb -->
        <nav class="breadcrumb" aria-label="breadcrumb">
            <div class="sec-container">
                <ul>
                    <li><a href="index.html">ホーム</a></li>
                    <li>お問い合わせ</li>
                </ul>
            </div>
        </nav>

        <!-- 電話でのお問い合わせ -->
        <section id="phone-contact" class="phone">
            <div class="phone__background">
                <p class="phone__title">
                    電話によるお問い合わせ
                </p>
                <div class="phone__border"></div>
                <p class="phone__number">
                    074-XXXX-XXX
                </p>
                <p class="phone_message">
                    受付時間 ／ **:00 ~ **:00 （〇 ~ 〇曜日）
                </p>
            </div>
        </section>

        <!-- メールでのお問い合わせ -->
        <section id="mail-contact">
            <div class="sec-container">
                <h2 class="contact__title sec-title">メールによるお問い合わせ</h2>
                <p class="contact__description">
                    いただいたメッセージは確認後、返信させていただきます。<br>
                    定休日には確認が出来ず、返信が遅くなる場合がございますが、ご了承ください。
                </p>
                <div class="contact__container">
                    <!-- 入力フォーム -->
                    <section>
                        <form class="contact-form" id="contactForm" novalidate>
                            <div class="contact-form__group">
                                <label class="contact-form__label">お名前<span class="contact-form__required">必須</span></label>
                                <input class="contact-form__input" type="text" name="name" placeholder="例）寺林 賢司" required>
                                <p class="contact-form__errmsg" id="error-name"></p>
                            </div>

                            <div class="contact-form__group">
                                <label class="contact-form__label">会社名</label>
                                <input class="contact-form__input" type="text" name="company" placeholder="例）〇〇株式会社">
                                <p class="contact-form__errmsg" id="error-company"></p>
                            </div>

                            <div class="contact-form__group">
                                <label class="contact-form__label">メールアドレス<span class="contact-form__required">必須</span></label>
                                <input class="contact-form__input" type="email" name="email" placeholder="例）example@mail.com" required>
                                <p class="contact-form__errmsg" id="error-email"></p>
                            </div>

                            <div class="contact-form__group">
                                <label class="contact-form__label">電話番号<span class="contact-form__required">必須</span></label>
                                <input class="contact-form__input" type="tel" name="phone" placeholder="例）090-1234-5678" required inputmode="numeric" pattern="[0-9\-]*">
                                <p class="contact-form__errmsg" id="error-phone"></p>
                            </div>

                            <div class="contact-form__group">
                                <label class="contact-form__label">お問い合わせ内容<span class="contact-form__required">必須</span></label>
                                <textarea class="contact-form__textarea" name="message" placeholder="お問い合わせ内容を入力してください" required></textarea>
                                <p class="contact-form__errmsg" id="error-message"></p>
                            </div>

                            <!-- プライバシーポリシー -->
                            <section class="policy">
                                <p class="policy__description">プライバシーポリシーをご確認ください。</p>
                                <div class="policy__box">
                                    <p class="policy__1stdescription">合同会社グロウエレクト（以下、「当社」）は、お客様の個人情報に関する法令を遵守し、個人情報の適切な取り扱いに努めます。</p>
                                    <h3 class="policy__title">1．個⼈情報の取得</h3>
                                    <p class="policy__text">当社は、業務の遂行に必要な範囲で、適正かつ公正な手段により個人情報を取得します。</p>
                                    <div class="policy__subtexts">
                                        <p class="policy__subtext">当社がお客さまに提供するサービスにおいて利用するため</p>
                                        <p class="policy__subtext">お客さまからの各種お問い合わせに対するご連絡のため</p>
                                        <p class="policy__subtext">求人応募に対するご連絡のため</p>
                                        <p class="policy__subtext">必要に応じてお客様に情報をお届けするとともに連絡を行なうため</p>
                                    </div>
                                    <h3 class="policy__title">2．個⼈情報の利⽤</h3>
                                    <p class="policy__text">当社が取得したお客さまの個人情報は、取得の際に示した利用目的の範囲内で利用し、お客さまの同意なく利用目的以外には利用いたしません。</p>
                                    <h3 class="policy__title">3．個⼈情報の提供</h3>
                                    <p class="policy__text">当社は、個人情報保護法等の法令に定めのある場合を除き、本人の同意を得ることなく第三者に提供することはありません。</p>
                                    <h3 class="policy__title">4．個⼈情報の取扱いに関する法令遵守</h3>
                                    <p class="policy__text">当社は、個人情報の取扱いに関する法令や行政機関等の定める指針等を遵守します。</p>
                                    <h3 class="policy__title">5．個⼈情報の安全管理</h3>
                                    <p class="policy__text">当社は、個人情報の漏洩、滅失または毀損の防止、その他の安全管理のために必要かつ適切な措置を講じます。</p>
                                    <hr class="policy__split">
                                    <p class="policy__2nddescription">ご不明な点および苦情・相談などがございましたら下記窓口までご連絡下さい。</p>
                                    <p class="policy__company">合同会社グロウエレクト</p>
                                    <p class="policy__company">〒939-8058 富山県富山市大泉２番地５</p>
                                </div>
                                <p class="policy__lastdescription">プライバシーポリシーに同意いただけだけましたら「入力内容を確認する」ボタンを押してください。</p>
                            </section>

                            <div class="contact-form__btnare">
                                <button class="contact-form__button" type="submit">入力内容を確認する</button>
                            </div>                        
                        </form>
                        
                    </section>

                    <!-- 確認モーダル -->
                    <section>
                        <div id="contact__overlay">
                            <div id="confirmModal">
                                <h3 class="contact__confirm_msg1">入力内容の確認</h3>
                                <p class="contact__confirm_msg2">「送信ボタン」を押すと、メッセージが送信されます。</p>
                                <div class="contact__confirm-item"><span class="contact__confirm_title">お名前</span>｜<span id="confirm-name"></span></div>
                                <div class="contact__confirm-item"><span class="contact__confirm_title">会社名</span>｜<span id="confirm-company"></span></div>
                                <div class="contact__confirm-item"><span class="contact__confirm_title">メール</span>｜<span id="confirm-email"></span></div>
                                <div class="contact__confirm-item"><span class="contact__confirm_title">電話</span>｜<span id="confirm-phone"></span></div>
                                <div class="contact__confirm-item"><span class="contact__confirm_title">内容</span>｜<span id="confirm-message"></span></div>
                                <p class="contact__confirm-result" id="result-message"></p>
                                <div class="contact__confirm-buttons">
                                    <button class="contact__confirm-return-btn" id="backBtn" type="button">戻る</button>
                                    <button class="contact__confirm-submit-btn" id="finalSubmit" type="button">送信</button>
                                </div>
                            </div>
                        </div>
                    </section>

                </div>
            </div>
        </section>
    </main>
    
    <div data-include="parts/footer.html"></div>

    <script src="include.js"></script>
</body>
</html>



















<script>
    const form = document.getElementById("contactForm");
    const backBtn = document.getElementById("backBtn");
    const overlay = document.getElementById("contact__overlay");
    const submitBtn = document.getElementById("finalSubmit");
    const result = document.getElementById("result-message");
    const ACCESS_TOKEN = "t002";

    form.addEventListener("submit", function(e){

        e.preventDefault();

        let valid = true;
        let errorElement = null;
        
        const name = this.name.value.trim();
        const company = this.company.value.trim();
        const email = this.email.value.trim();
        const phone = this.phone.value.trim();
        const message = this.message.value.trim();
    

        const errorElements = {
            name: document.getElementById("error-name"),
            company: document.getElementById("error-company"),
            email: document.getElementById("error-email"),
            phone: document.getElementById("error-phone"),
            message: document.getElementById("error-message"),
        };

        // エラーメッセージをリセット
        for (const key in errorElements) {
            errorElements[key].textContent = "";
        }

        // 入力チェック
        if(!message){
            errorElements.message.textContent = "お問い合わせ内容を入力してください。";
            errorElement = errorElements.message;
            valid = false;
        }
        else if(message.length > 1000){
            errorElements.message.textContent = "1000文字以内にしてください。";
            errorElement = errorElements.message;
            valid = false;
        }
        if (!phone) {
            errorElements.phone.textContent = "電話番号を入力してください。";
            errorElement = errorElements.phone;
            valid = true;
        }
        else if(!phone.match(/^0\d{1,4}-?\d{1,4}-?\d{3,4}$/) || phone.length > 20){
            errorElements.phone.textContent = "電話番号の形式が正しくありません（例：090-1234-5678）。";
            errorElement = errorElements.phone;
            valid = false;
        } 
        if (!email){
            errorElements.email.textContent = "メールアドレスを入力してください。";
            errorElement = errorElements.email;
            valid = true;
        }
        else if(email.length > 100){
            errorElements.email.textContent = "100文字以内にしてください。";
            errorElement = errorElements.email;
            valid = false;
        }
        else if(!email.match(/^[^@\s]+@[^@\s]+\.[^@\s]+$/)){
            errorElements.email.textContent = "メールアドレスの形式が正しくありません。";
            errorElement = errorElements.email;
            valid = false;
        }        
        if(!name){
            errorElements.name.textContent = "お名前を入力してください。";
            errorElement = errorElements.name;
            valid = false;
        }
        else if(name.length > 50){
            errorElements.name.textContent = "50文字以内にしてください。";
            errorElement = errorElements.name;
            valid = false;
        }


        if(!valid) {
            if(errorElement){
                errorElement.scrollIntoView({ behavior: "smooth", block: "center" });
            }
            return;
        };

        // モーダルに内容を反映
        document.getElementById("confirm-name").textContent = name;
        document.getElementById("confirm-company").textContent = company || "（なし）";
        document.getElementById("confirm-email").textContent = email;
        document.getElementById("confirm-phone").textContent = phone;
        document.getElementById("confirm-message").textContent = message;

        // モーダル表示
        document.getElementById("contact__overlay").style.display = "flex";
    });

    // 最終確認 戻るボタン
    backBtn.addEventListener("click", () => {
        overlay.style.display = "none";
    });

    // 最終確認 送信ボタン
    submitBtn.addEventListener("click", async () => {

        // すぐに二度押しできないようにする
        submitBtn.disabled = true;
        submitBtn.style.opacity = "0.6";
        submitBtn.style.pointerEvents = "none";
        backBtn.style.pointerEvents = "none";

        result.textContent = "送信中です…";
        result.style.color = "#333";

        // const form = document.getElementById("contactForm");
        const data = Object.fromEntries(new FormData(form).entries());
        data.token = ACCESS_TOKEN;
        
        result.textContent = "送信中です…";
        try {
            const res = await fetch('https://script.google.com/macros/s/AKfycbxyd3dG1FomBR8N1sL8RbP618kO2EwJhnwNB-XC48suLcO6in6_uzGwmEo4OTIxjMmrtg/exec', {
                method: 'POST',
                // headers: {"Content-Type": "application/json"},
                body: JSON.stringify(data),
            });

            const json = await res.json();

            if (json.result === 'success') {
                result.textContent = '送信が完了しました。';
                result.style.color = '#15b815';
                form.reset();
                
                submitBtn.style.display = "none"; // ボタンを非表示にする
                backBtn.textContent = "閉じる"; //  戻るボタンのテキストを「閉じる」に変更
            } else {
                result.textContent = '送信に失敗しました。ネットワーク環境をご確認の上、再度送信してください。';
                result.style.color = '#e60000';
            }
    
        } catch (err) {
            console.error(err);
            result.textContent = 'エラーが発生しました。';
            result.style.color = '#e60000';
        }

        // alert('aaa')


        // 処理終了後、再度ボタンを有効化
        submitBtn.disabled = false;
        submitBtn.style.opacity = "1";
        submitBtn.style.pointerEvents = "auto";
        backBtn.style.pointerEvents = "auto";
    });

    // 送信完了後 閉じるボタン（戻るボタン）
    backBtn.addEventListener("click", () => {
        overlay.style.display = "none";
        result.textContent = "";
        submitBtn.style.display = "inline-block";
        backBtn.textContent = "戻る";
    });


    
    document.getElementById('phone').addEventListener('input', function (e) {

        // 数字以外を削除
        let value = e.target.value.replace(/\D/g, '');

        // フォーマット: 3桁 - 4桁 - 4桁
        if (value.length > 3 && value.length <= 7) {
            value = value.replace(/(\d{3})(\d+)/, '$1-$2');
        } else if (value.length > 7) {
            value = value.replace(/(\d{3})(\d{4})(\d+)/, '$1-$2-$3');
        }

        e.target.value = value;
    });


</script>

